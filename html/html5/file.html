<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.32">
    <link rel="icon" href="./images/favicon.png"><title>HTML5 File | 龙趸</title><meta name="description" content="石斑鱼杂记">
    <link rel="modulepreload" href="/vuepress-2021/assets/app.147292e0.js"><link rel="modulepreload" href="/vuepress-2021/assets/file.html.343db98b.js"><link rel="modulepreload" href="/vuepress-2021/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/vuepress-2021/assets/file.html.58bcd23a.js">
    <link rel="stylesheet" href="/vuepress-2021/assets/style.43f851d6.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-2021/" class=""><img class="logo" src="/vuepress-2021/images/logo.png" alt="龙趸"><span class="site-name can-hide">龙趸</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/vuepress-2021/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/html/" class="router-link-active" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2017/" class="" aria-label="2017"><!--[--><!--]--> 2017 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2018/" class="" aria-label="2018"><!--[--><!--]--> 2018 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2019/" class="" aria-label="2019"><!--[--><!--]--> 2019 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/guihua/vuepress-2021" rel="noopener noreferrer" target="_blank" aria-label="Github 地址"><!--[--><!--]--> Github 地址 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/vuepress-2021/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/html/" class="router-link-active" aria-label="HTML"><!--[--><!--]--> HTML <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2017/" class="" aria-label="2017"><!--[--><!--]--> 2017 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2018/" class="" aria-label="2018"><!--[--><!--]--> 2018 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/vuepress-2021/2019/" class="" aria-label="2019"><!--[--><!--]--> 2019 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/guihua/vuepress-2021" rel="noopener noreferrer" target="_blank" aria-label="Github 地址"><!--[--><!--]--> Github 地址 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p class="sidebar-item sidebar-heading">HTML5 表单 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress-2021/html/html5/input.html" class="sidebar-item" aria-label="HTML5 Input 类型"><!--[--><!--]--> HTML5 Input 类型 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/element.html" class="sidebar-item" aria-label="HTML5 表单元素"><!--[--><!--]--> HTML5 表单元素 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/attribute.html" class="sidebar-item" aria-label="HTML5 表单属性"><!--[--><!--]--> HTML5 表单属性 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading active">HTML5 功能 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress-2021/html/html5/video.html" class="sidebar-item" aria-label="HTML5 视频"><!--[--><!--]--> HTML5 视频 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/audio.html" class="sidebar-item" aria-label="HTML5 音频"><!--[--><!--]--> HTML5 音频 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/drag.html" class="sidebar-item" aria-label="HTML5 拖放"><!--[--><!--]--> HTML5 拖放 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/canvas.html" class="sidebar-item" aria-label="HTML5 Canvas"><!--[--><!--]--> HTML5 Canvas <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/canvas2.html" class="sidebar-item" aria-label="HTML5 Canvas"><!--[--><!--]--> HTML5 Canvas <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/svg.html" class="sidebar-item" aria-label="HTML5 内联 SVG"><!--[--><!--]--> HTML5 内联 SVG <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/geolocation.html" class="sidebar-item" aria-label="HTML5 地理定位"><!--[--><!--]--> HTML5 地理定位 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/storage.html" class="sidebar-item" aria-label="HTML 5 Web 存储"><!--[--><!--]--> HTML 5 Web 存储 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/manifest.html" class="sidebar-item" aria-label="HTML5 应用程序缓存"><!--[--><!--]--> HTML5 应用程序缓存 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/worker.html" class="sidebar-item" aria-label="HTML 5 Web Workers"><!--[--><!--]--> HTML 5 Web Workers <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="HTML5 File"><!--[--><!--]--> HTML5 File <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_1-核心对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.核心对象"><!--[--><!--]--> 1.核心对象 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_1-1-文件选择" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 文件选择"><!--[--><!--]--> 1.1 文件选择 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_1-2-通过拖放选择文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 通过拖放选择文件"><!--[--><!--]--> 1.2 通过拖放选择文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_1-3-访问被选择的文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 访问被选择的文件"><!--[--><!--]--> 1.3 访问被选择的文件 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-通过-filereader-来加载文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.通过 FileReader 来加载文件"><!--[--><!--]--> 2.通过 FileReader 来加载文件 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-1-创建一个-filereader" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 创建一个 FileReader"><!--[--><!--]--> 2.1 创建一个 FileReader <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-2-将一个文件作为文本来加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 将一个文件作为文本来加载"><!--[--><!--]--> 2.2 将一个文件作为文本来加载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-3-通过-data-url-来加载文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 通过 Data URL 来加载文件"><!--[--><!--]--> 2.3 通过 Data URL 来加载文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-4-通过-arraybuffer-来加载文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 通过 ArrayBuffer 来加载文件"><!--[--><!--]--> 2.4 通过 ArrayBuffer 来加载文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-2021/html/html5/file.html#_2-5-跟踪文件加载的进程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 跟踪文件加载的进程"><!--[--><!--]--> 2.5 跟踪文件加载的进程 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/vuepress-2021/html/html5/window.history.html" class="sidebar-item" aria-label="window.history"><!--[--><!--]--> window.history <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/css.retina.html" class="sidebar-item" aria-label="retina 下背景图片实现"><!--[--><!--]--> retina 下背景图片实现 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-2021/html/html5/css.will.change.html" class="sidebar-item" aria-label="CSS3 will-change"><!--[--><!--]--> CSS3 will-change <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p class="sidebar-item sidebar-heading">HTML5 杂谈 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress-2021/html/html5/download.html" class="sidebar-item" aria-label="HTML5 中的 download 属性"><!--[--><!--]--> HTML5 中的 download 属性 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="html5-file" tabindex="-1"><a class="header-anchor" href="#html5-file" aria-hidden="true">#</a> HTML5 File</h1><p>HTML5 File API 允许页面使用 JavaScript 来调用和处理本地文件系统的文件。</p><h2 id="_1-核心对象" tabindex="-1"><a class="header-anchor" href="#_1-核心对象" aria-hidden="true">#</a> 1.核心对象</h2><p>HTML5 File API 包含以下的核心对象：</p><ul><li><p>FileList</p><p>FileList 对象代表本地文件系统中的一组文件。</p></li><li><p>File</p><p>File 对象代表本地文件系统中的一个文件</p></li><li><p>Blob</p><p>Blob 对象代表一个二进制大型对象（BLOB），BLOB 是本地文件系统中的单个文件的数据</p></li><li><p>FileReader</p></li></ul><h3 id="_1-1-文件选择" tabindex="-1"><a class="header-anchor" href="#_1-1-文件选择" aria-hidden="true">#</a> 1.1 文件选择</h3><p>选择一个文件</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">readFiles</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>选择多个文件时，在 <code>&lt;input&gt;</code> 元素中添加一个 <code>multiple</code> 属性</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">readFiles</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_1-2-通过拖放选择文件" tabindex="-1"><a class="header-anchor" href="#_1-2-通过拖放选择文件" aria-hidden="true">#</a> 1.2 通过拖放选择文件</h3><p>我们可以将 HTML5 file API 和 HTML5 元素拖放相结合来选择文件。这种选择文件的方式需要实现用户从本地电脑的文件系统中（在浏览器之外）拖拽一个文件到浏览器的 HTML 页面指定的放置区域。HTML 页面能通过 JavaScript 来检测是否有文件被放置在指定的区域。</p><p>下面的代码是如何设置一个放置区域 HTML 元素，使它能够检测到是否有文件放置到它上面。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileDropZone<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>请拖拽文件到这里<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">drop</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    evt<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> fileList <span class="token operator">=</span> event<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">;</span> <span class="token comment">// 通过fileList接收文件</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">dragOver</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    evt<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    evt<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>dropEffect <span class="token operator">=</span> <span class="token string">&#39;copy&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> dropZone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;fileDropZone&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  dropZone<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;dragover&#39;</span><span class="token punctuation">,</span> dragOver<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dropZone<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;drop&#39;</span><span class="token punctuation">,</span> drop<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><code>dragOver()</code> 和 <code>drop()</code> 函数设置放置区域 HTML 元素的拖和放事件监听。</p><h3 id="_1-3-访问被选择的文件" tabindex="-1"><a class="header-anchor" href="#_1-3-访问被选择的文件" aria-hidden="true">#</a> 1.3 访问被选择的文件</h3><p>当用户选择一个或多个文件之后，有两种方式访问这些被选择的文件。</p><p>第一种访问被选择文件的方式是访问 <code>input</code> 元素的 <code>files</code> 属性。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>var inputField = document.getElementById(&#39;theFileInput&#39;);

var selectedFiles = inputField.files;

for(var i=0; i&lt;selectedFiles.length; i++) {
  var file = selectedFiles[i);
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>第二种访问被选择文件的方式是通过 <code>input</code> 元素的 <code>onchange</code> 事件监听，被选择的文件会作为 event 对象的参数被传入。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">readFiles</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">multiple</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">readFiles</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fileList <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>event.target.files</code> 对象是一个 <code>FileList</code> 对象。它包含一组被选择的文件（<code>File</code> 对象）。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">function</span> <span class="token function">readFiles</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fileList <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">;</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fileList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> fileList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// a File object</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;i: &quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot; - &quot;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_2-通过-filereader-来加载文件" tabindex="-1"><a class="header-anchor" href="#_2-通过-filereader-来加载文件" aria-hidden="true">#</a> 2.通过 FileReader 来加载文件</h2><p><code>FileReader</code> 对象有下面的一些方法可以用于读取文件：</p><ul><li>readAsText()</li><li>readAsDataUrl()</li><li>readAsArrayBuffer()</li></ul><p>上面的方法都使用一个 File 对象或 Blob 对象作为参数。</p><p>Blob 对象代表部分或整个文件，可以从 File 对象中创建一个 Blob 对象。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> theFile <span class="token operator">=</span> fileList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 从 FileList 获取一个 File 对象</span>

<span class="token keyword">var</span> from <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> to <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> theFile<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 Blob 对象</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-1-创建一个-filereader" tabindex="-1"><a class="header-anchor" href="#_2-1-创建一个-filereader" aria-hidden="true">#</a> 2.1 创建一个 FileReader</h3><p>要使用 <code>FileReader</code> 你先要创建 <code>FileReader</code> 对象。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_2-2-将一个文件作为文本来加载" tabindex="-1"><a class="header-anchor" href="#_2-2-将一个文件作为文本来加载" aria-hidden="true">#</a> 2.2 将一个文件作为文本来加载</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readFiles</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> fileList <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fileList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadAsText</span><span class="token punctuation">(</span>fileList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">loadAsText</span><span class="token punctuation">(</span><span class="token parameter">theFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">loadedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回包含被加载的文件</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>loadedEvent<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>theFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>文件在 <code>loadAsText()</code> 函数中被加载。</p><h3 id="_2-3-通过-data-url-来加载文件" tabindex="-1"><a class="header-anchor" href="#_2-3-通过-data-url-来加载文件" aria-hidden="true">#</a> 2.3 通过 Data URL 来加载文件</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadAsUrl</span><span class="token punctuation">(</span><span class="token parameter">theFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">loadedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;theImage&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> loadedEvent<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>theFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>预览上传的图片。</p><h3 id="_2-4-通过-arraybuffer-来加载文件" tabindex="-1"><a class="header-anchor" href="#_2-4-通过-arraybuffer-来加载文件" aria-hidden="true">#</a> 2.4 通过 ArrayBuffer 来加载文件</h3><p><code>FileReader</code> 对象的 <code>readAsArrayBuffer()</code> 函数可以用于作为 <code>ArrayBuffer</code> 来读取文件数据。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadAsUrl</span><span class="token punctuation">(</span><span class="token parameter">theFile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">loadedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> arrayBuffer <span class="token operator">=</span> loadedEvent<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token keyword">var</span> dataView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> arrayBuffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> byte <span class="token operator">=</span> dataView<span class="token punctuation">.</span><span class="token function">getUint8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取ArrayBuffer的第一个字节</span>

    <span class="token comment">//... 处理余下的dataView ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>theFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_2-5-跟踪文件加载的进程" tabindex="-1"><a class="header-anchor" href="#_2-5-跟踪文件加载的进程" aria-hidden="true">#</a> 2.5 跟踪文件加载的进程</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

reader<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> percentLoaded <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&#39;total: &#39;</span> <span class="token operator">+</span>
      progressEvent<span class="token punctuation">.</span>total <span class="token operator">+</span>
      <span class="token string">&#39;, loaded: &#39;</span> <span class="token operator">+</span>
      progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">+</span>
      <span class="token string">&#39;(&#39;</span> <span class="token operator">+</span>
      percentLoaded <span class="token operator">+</span>
      <span class="token string">&#39;%)&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>传入到 <code>onprogress</code> 事件中的 <code>progressEvent</code> 参数包含一个布尔值的属性 <code>lengthComputable</code>。如果这个属性的值为 <code>true</code>，你就可以计算文件已经被加载了多少。</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/guihua/vuepress-2021/edit/main/html/html5/file.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: guihuapeng@126.com">guihua.pgh</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress-2021/html/html5/worker.html" class="" aria-label="HTML 5 Web Workers"><!--[--><!--]--> HTML 5 Web Workers <!--[--><!--]--></a></span><span class="next"><a href="/vuepress-2021/html/html5/window.history.html" class="" aria-label="window.history"><!--[--><!--]--> window.history <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/vuepress-2021/assets/app.147292e0.js" defer></script>
  </body>
</html>
